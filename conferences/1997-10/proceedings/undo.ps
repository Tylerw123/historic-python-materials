%!PS-Adobe-2.0
%%Creator: dvips 5.66 (MiKTeX 1.07) Copyright 1997 Radical Eye Software (www.radicaleye.com)
%%Title: undo.dvi
%%CreationDate: Wed Sep 17 14:43:22 1997
%%Pages: 7
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%DocumentFonts: Times-Bold Times-Roman Times-Italic Helvetica
%%EndComments
%DVIPSCommandLine: dvips undo
%DVIPSParameters: dpi=600
%DVIPSSource:  TeX output 1997.09.17:1443
%%BeginProcSet: tex.pro
%!
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR[matrix currentmatrix{dup dup round sub abs 0.00001 lt{round}if}
forall round exch round exch]setmatrix}N /@landscape{/isls true N}B
/@manualfeed{statusdict /manualfeed true put}B /@copies{/#copies X}B
/FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{
/nn 8 dict N nn begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N
string /base X array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N
end dup{/foo setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{
/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]
N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data dup
length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{
128 ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub
get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data
dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N
/rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup
/base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx
0 ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff
setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff
.1 sub]{ch-image}imagemask restore}B /D{/cc X dup type /stringtype ne{]}
if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup
length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{
cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul
add .99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore userdict
/eop-hook known{eop-hook}if showpage}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{dup length product length le{dup length product
exch 0 exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}
ifelse end{{gsave TR -.1 .1 TR 1 1 scale rulex ruley false RMat{BDot}
imagemask grestore}}{{gsave TR -.1 .1 TR rulex ruley scale 1 1 false
RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath transform round
exch round exch itransform moveto rulex 0 rlineto 0 ruley neg rlineto
rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail{dup
/delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}B /d{
-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{4 M}B
/w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{p 1 w}
B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p a}B
/bos{/SS save N}B /eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc
% @psencodingfile{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "14 April 1995",
%   filename = "8r.enc",
%   email = "kb@cs.umb.edu",
%   address = "135 Center Hill Rd. // Plymouth, MA 02360",
%   codetable = "ISO/ASCII",
%   checksum = "xx",
%   docstring = "Encoding for TrueType or Type 1 fonts to be used with TeX."
% }
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there down to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def

%%EndProcSet
%%BeginProcSet: texps.pro
%!
TeXDict begin /rf{findfont dup length 1 add dict begin{1 index /FID ne 2
index /UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type /integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics /Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont /setfont cvx]cvx def}def /ObliqueSlant
{dup sin S cos div neg}B /SlantFont{4 index mul add}def /ExtendFont{3 -1
roll mul exch}def /ReEncodeFont{/Encoding exch def}def end

%%EndProcSet
TeXDict begin 39158280 55380996 1000 600 600
(c:\business\Papers\python\undo/undo.dvi) @start /Fa
137[42 46 28 32 37 1[46 42 46 69 3[23 3[37 46 2[42 11[60
4[51 3[55 5[51 1[60 15[42 42 42 42 2[21 46[{
TeXBase1Encoding ReEncodeFont}23 83.022 /Times-Bold rf
%DVIPSBitmapFont: Fb cmr10 10 1
/Fb 1 44 df<000000300000000000007800000000000078000000000000780000000000
007800000000000078000000000000780000000000007800000000000078000000000000
780000000000007800000000000078000000000000780000000000007800000000000078
000000000000780000000000007800000000000078000000000000780000000000007800
000000000078000000000000780000000000007800000000000078000000000000780000
007FFFFFFFFFFFF8FFFFFFFFFFFFFCFFFFFFFFFFFFFC7FFFFFFFFFFFF800000078000000
000000780000000000007800000000000078000000000000780000000000007800000000
000078000000000000780000000000007800000000000078000000000000780000000000
007800000000000078000000000000780000000000007800000000000078000000000000
780000000000007800000000000078000000000000780000000000007800000000000078
00000000000078000000000000780000000000003000000036367BAF41>43
D E
%EndDVIPSBitmapFont
%DVIPSBitmapFont: Fc cmsy10 10 1
/Fc 1 18 df<7FFFFFFFFFFFF8FFFFFFFFFFFFFCFFFFFFFFFFFFFC7FFFFFFFFFFFF80000
000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000007FFFFFFFFFFFF8FFFFFFFFFF
FFFCFFFFFFFFFFFFFC7FFFFFFFFFFFF80000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000
0000000000007FFFFFFFFFFFF8FFFFFFFFFFFFFCFFFFFFFFFFFFFC7FFFFFFFFFFFF83628
7BA841>17 D E
%EndDVIPSBitmapFont
/Fd 134[29 29 1[29 33 18 26 26 1[33 33 33 48 18 2[18
3[29 33 29 33 33 11[48 4[41 48 44 1[37 3[48 1[41 41 48
2[41 18[17 46[{TeXBase1Encoding ReEncodeFont}29 66.4176
/Times-Italic rf
%DVIPSBitmapFont: Fe cmsy8 8 2
/Fe 2 106 df<00030007000F000E000E001E001C003C003800380078007000F000E000
E001E001C003C003800780070007000F000E001E001C001C003C003800780070007000F0
00E000F00070007000780038003C001C001C001E000E000F00070007000780038003C001
C001E000E000E000F00070007800380038003C001C001E000E000E000F0007000310437A
B11B>104 D<E000E000F00070007000780038003C001C001C001E000E000F0007000700
0780038003C001C001E000E000E000F00070007800380038003C001C001E000E000E000F
0007000F000E000E001E001C003C003800380078007000F000E000E001E001C003C00380
0780070007000F000E001E001C001C003C003800780070007000F000E000E00010437CB1
1B>I E
%EndDVIPSBitmapFont
/Ff 105[37 1[22 22 25[33 33 48 33 37 18 33 22 37 37 37
37 55 15 33 15 15 37 37 18 37 37 33 37 37 3[18 1[18 5[48
41 44 2[44 52 48 55 37 2[18 48 52 41 44 48 48 44 44 3[39
2[18 37 1[37 2[37 37 37 37 37 18 18 22 18 39 1[22 22
15 1[59 1[37 1[18 27[22 1[33 33 22 1[{TeXBase1Encoding ReEncodeFont}71
66.4176 /Helvetica rf /Fg 64[37 42[37 37 24[37 42 42
60 42 42 23 32 28 42 42 42 42 65 23 42 23 23 42 42 28
37 42 37 42 37 3[28 1[28 1[60 1[78 1[60 51 46 55 1[46
60 60 74 51 60 32 28 60 60 46 51 60 55 55 60 1[37 1[47
2[23 42 1[42 42 1[42 42 42 42 42 23 21 28 21 2[28 28
28 5[28 29[46 46 2[{TeXBase1Encoding ReEncodeFont}74
83.022 /Times-Roman rf /Fh 134[50 50 1[50 55 33 39 44
1[55 50 55 83 28 1[33 28 55 50 33 44 55 44 55 50 11[72
66 1[72 2[78 1[94 3[39 78 78 61 2[72 1[72 6[33 7[50 50
3[33 45[{TeXBase1Encoding ReEncodeFont}37 99.6264 /Times-Bold
rf /Fi 107[46 46 25[37 37 55 37 42 23 32 32 1[42 42 42
60 23 37 23 23 42 42 23 37 42 37 42 42 3[32 1[32 3[69
1[60 46 42 51 1[51 60 2[46 55 1[28 2[51 51 60 55 1[51
6[28 42 4[42 42 42 42 2[21 28 5[28 5[28 30[42 2[{
TeXBase1Encoding ReEncodeFont}54 83.022 /Times-Italic
rf /Fj 134[45 1[66 45 1[30 35 40 1[51 45 51 1[25 2[25
3[40 51 40 51 45 11[66 1[51 3[71 66 5[71 6[66 12[45 45
45 45 2[23 46[{TeXBase1Encoding ReEncodeFont}27 90.9091
/Times-Bold rf /Fk 133[39 2[66 2[28 39 39 2[50 50 72
2[28 28 1[50 28 44 50 44 1[50 6[55 6[50 3[72 10[72 3[92
17[25 46[{TeXBase1Encoding ReEncodeFont}22 99.6264 /Times-Italic
rf /Fl 134[50 1[72 1[50 28 39 3[50 50 2[50 1[28 14[61
12[89 77[{TeXBase1Encoding ReEncodeFont}11 99.6264 /Times-Roman
rf /Fm 134[60 1[86 60 1[40 1[53 1[66 60 66 100 33 66
1[33 66 60 1[53 66 53 1[60 11[86 1[66 2[73 6[47 2[73
70[{TeXBase1Encoding ReEncodeFont}23 119.552 /Times-Bold
rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%PaperSize: A4

%%EndSetup
%%Page: 1 1
1 0 bop 577 714 a Fm(Implementing)30 b(a)g(Selecti)o(v)o(e)g(Undo)h
(Framew)o(ork)f(in)h(Python)1607 955 y Fl(Monty)24 b(Zuk)o(o)n(wski)
1370 1071 y Fk(Zer)l(o)h(to)f(One)h(Softwar)l(e)g(Design)1609
1187 y(jamz@cdsnet.net)0 1513 y Fj(Abstract)83 1707 y
Fi(I')o(ve)c(implemented)g(in)h(Python)e(the)i(undo)e(algorithm)h
(found)0 1807 y(in)39 b(\223Undoing)d(Actions)i(in)h(Collabor)o(ative)e
(W)-8 b(ork:)62 b(F)-5 b(r)o(ame-)0 1906 y(work)24 b(and)e
(Experience\224)h(by)g(Pr)o(akash)g(and)f(Knister)j([PK94)o(].)0
2006 y(Their)e(appr)l(oac)o(h)e(helps)h(structur)m(e)h(the)g(objects)g
(that)f(mak)o(e)h(up)0 2106 y(a)28 b(\223document\224.)48
b(Those)29 b(same)f(objects)g(ar)m(e)h(well)g(suited)f(for)0
2205 y(use)17 b(in)h(an)f(embedded)e(langua)o(g)o(e)g(lik)o(e)j
(Python:)k(with)c(them)f(you)0 2305 y(can)24 b(write)h(scripts)g(that)f
(can)g(be)g(undone!)35 b(I')o(ve)24 b(implemented)0 2404
y(standar)m(d)c(\002le)h(oper)o(ations)e(as)j(a)f(simple)g(concr)m(ete)
g(e)n(xample)f(of)0 2504 y(using)g(the)g(fr)o(ame)o(work.)0
2815 y Fh(1)99 b(Intr)n(oduction)83 3009 y Fg(I')l(v)o(e)17
b(al)o(w)o(ays)h(w)o(ondered)e(ho)n(w)h(to)h(design)f(the)h(objects)f
(which)0 3109 y(w)o(ork)k(together)g(to)h(represent)f(a)i(document,)d
(the)i Fi(model)g Fg(of)g(the)0 3208 y(model-vie)n(w-controller)15
b(paradigm.)22 b(Ho)n(w)e(to)f(design)g(them)f(to)0 3308
y(be)24 b(easily)g(scriptable?)35 b(Undoable?)f(W)-7
b(ell,)26 b(when)e(I)g(stumbled)0 3407 y(onto)j(\223Undoing)f(Actions)i
(in)g(Collaborati)n(v)o(e)e(W)-7 b(ork:)40 b(Frame-)0
3507 y(w)o(ork)23 b(and)g(Experience\224)e(by)i(Prakash)g(and)g
(Knister)h([PK94)o(])f(I)0 3607 y(struck)c(a)h(goldmine.)j(Their)d
(paper)e(gi)n(v)o(es)i(a)g(great)f(o)o(v)o(ervie)n(w)f(of)0
3706 y(undo)c(algorithms)g(and)h(when)f(and)h(why)g(to)g(use)g(them.)23
b(The)15 b(\223se-)0 3806 y(lecti)n(v)o(e)25 b(undo\224)f(algorithm)g
(presented)g(by)i(them)f(lets)h(the)g(user)0 3906 y(undo)16
b Fi(any)h Fg(pre)n(vious)f(action,)i(not)f(just)h(the)g(last.)25
b(So)18 b(in)g(a)g(group-)0 4005 y(w)o(are)26 b(application,)g(she)h
(or)f(he)g(can)g(undo)f(her)h(or)g(his)g(last)i(ac-)0
4105 y(tion,)e(not)f(just)g(the)h(last)g(action)e(applied)g(to)i(the)f
(document)e(by)0 4204 y(someone)c(else.)83 4304 y(As)25
b(an)g(adminstrator)e(of)h(hundreds)e(of)j(thousands)e(of)h(mul-)0
4404 y(timedia)d(\002les,)i(I)g(wrote)e(man)o(y)g(Python)f(scripts)j
(to)f(mo)o(v)o(e)e(them)0 4503 y(around,)i(rename)g(them)h(and)f(tweak)
h(them)g(for)g(our)f(b)n(uild)h(pro-)0 4603 y(cess)k(to)g(turn)f(them)g
(into)g(CD-R)m(OMs.)44 b(Ev)o(ery)25 b(no)n(w)h(and)g(then)0
4703 y(I')l(d)c(get)g(cock)o(y)-5 b(,)21 b(run)g(a)i(script)g(without)e
(testing)h(it,)i(and)e(rename)0 4802 y(all)j(the)g(\002les)g(to)g(the)f
(same)h(\002lename,)g(or)f(do)g(other)g(stupid)g(\002le)0
4902 y(tricks.)32 b(\223If)23 b(only)f(I)h(could)e(undo)h(that)g
(script!\224)33 b(I)23 b(w)o(ould)f(think.)0 5001 y(W)-7
b(ell,)23 b(no)n(w)e(I)g(can)h(since)f(I')l(v)o(e)f(written)i(undoable)
d(cop)o(y)-5 b(,)20 b(mo)o(v)o(e,)0 5101 y(link)j(and)g(delete)g
(operations)f(as)i(a)f(simple)h(application)e(of)h(the)0
5201 y(selecti)n(v)o(e)d(undo)f(algorithm.)83 5300 y(At)33
b(\002rst)h(I)f(sat)g(do)n(wn)f(to)g(write)h(a)g(general)f(purpose)f
(undo)0 5400 y(module.)57 b(Y)-9 b(ou,)34 b(the)d(programmer)m(,)g
(could)f(just)i(drop)f(it)h(into)0 5500 y(your)25 b(application,)g(add)
g(some)h(glue,)g(and)g(get)g(undo)e(for)h(free.)0 5599
y(I)d(wish!)31 b(It)23 b(turned)e(out)h(that)g(ho)n(w)f(the)i(undo)d
(algorithm)h(w)o(orks)0 5699 y(is)33 b(tightly)e(link)o(ed)h(to)g(ho)n
(w)f(the)h(b)n(uilding)f(block)g(objects)h(are)0 5799
y(designed.)41 b(Or)26 b(rather)f(the)g(other)g(w)o(ay)h(around:)35
b(the)26 b(b)n(uilding)2025 1513 y(block)31 b(objects)i(need)e(to)i(be)
f(designed)g(to)g(\002t)h(into)g(the)f(undo)2025 1612
y(frame)n(w)o(ork.)48 b(Since)29 b(undo)e(is)j(one)e(of)h(those)f
(things)g(I)h(w)o(ould)2025 1712 y(normally)19 b(w)o(ant)i(in)f(an)h
(application,)e(I)i(w)o(as)g(glad)f(to)h(learn)f(ho)n(w)2025
1812 y(to)c(write)g(objects)f(that)h(beha)n(v)o(e)e(well)j(with)e(the)h
(undo)e(algorithm.)2108 1911 y(I)21 b(ha)n(v)o(e)f(written)h(a)g
(general)f(purpose)f Ff(Histor)r(y)j Fg(module)d(which)2025
2011 y(implements)33 b(the)h(selecti)n(v)o(e)f(undo)f(algorithm.)65
b(It)34 b(isn')o(t)f(and)2025 2110 y(cannot)24 b(be)h(a)g(black)g(box)f
(module.)38 b(Y)-9 b(ou)24 b(need)h(to)g(understand)2025
2210 y(ho)n(w)k(it)i(w)o(orks)e(in)h(order)f(too)g(use)i(it.)54
b(That')-5 b(s)30 b(why)f(I'm)g(pre-)2025 2310 y(senting)h(it)i(as)f(a)
g Fi(liter)o(ate)g(pr)l(o)o(gr)o(am)f Fg(as)i(described)d(by)h(Knuth)
2025 2409 y([Knu92)n(])22 b(to)g(e)o(xplain)f(ho)n(w)g(it)i(w)o(orks.)
29 b(Literate)22 b(programming)2025 2509 y(lets)e(me)g(write)g(my)f
(code)g(and)g(documentation)d(in)k(one)f(\002le)h(and)2025
2609 y(in)c(an)o(y)f(order)f(I)i(w)o(ant,)g(so)g(I)g(can)f(e)o(xplain)g
(what)g(I'm)g(doing)g(in)h(the)2025 2708 y(order)h(I)i(think)e(best,)i
(not)f(the)g(order)g(imposed)f(by)h(the)g(program-)2025
2808 y(ming)29 b(language.)52 b(The)29 b(same)h(literate)g(program)d
(\002le)k(creates)2025 2907 y(this)i(document)e(as)i(well)g(as)h(the)e
(machine)g(readable)f(source)2025 3007 y(code.)2025 3206
y Fj(1.1)92 b(Selecti)o(v)o(e)25 b(Undo)d(Ov)o(er)o(view)2108
3406 y Fg(Please)39 b(do)e(read)g(Prakash)g(and)h(Knister)g([PK94)n(])g
(to)g(un-)2025 3505 y(derstand)g Fi(why)i Fg(their)f(algorithm)f(w)o
(orks.)83 b(Here')-5 b(s)40 b(a)g(quick)2025 3605 y(o)o(v)o(ervie)n(w)
32 b(of)i Fi(how)g Fg(it)h(w)o(orks.)66 b(De\002ne)34
b(operations)f(that)h(af-)2025 3704 y(fect)21 b(your)e(state)i(\(the)g
(document\).)j(All)d(such)f(operations)g(must)2025 3804
y(de\002ne)30 b(an)g(in)m(v)o(erse)f(operation.)53 b(Applying)28
b(this)j(in)m(v)o(erse)e(im-)2025 3904 y(mediately)c(after)h(the)h
(operation)d(nulli\002es)i(it)h(and)f(returns)g(the)2025
4003 y(document)c(to)i(the)g(state)g(before)f(applying)f(the)i
(operation.)34 b(At)2025 4103 y(this)20 b(point)e(you)g(ha)n(v)o(e)g
(the)h(Command)f(pattern)g(as)i(described)d(in)2025 4203
y Fi(Design)j(P)-7 b(atterns)20 b Fg([EG94)o(,)g(pages)g(233-242].)2108
4302 y(If)c(you,)g(the)h(programmer)m(,)c(w)o(ant)k(to)f(undo)g(an)g
(operation)e(that)2025 4402 y(w)o(as)22 b(not)e(the)h(last)h(one,)f
(you)f(can')o(t)g(al)o(w)o(ays)h(get)g(a)o(w)o(ay)g(with)g(ap-)2025
4501 y(plying)k(the)i(in)m(v)o(erse)e(of)i(that)g(operation)d(to)j(the)
g(current)e(state.)2025 4601 y(Say)d(my)g(document)e(is)j(the)f
(sentence)g(\223Python)e(rocks!\224.)30 b(I)22 b(se-)2025
4701 y(lect)h(\223rocks\224)f(and)f(type)i(in)f(\223rules\224.)32
b(Call)23 b(that)g Fi(op1)p Fg(,)f(an)g Ff(Inser)s(t-)2025
4800 y(T)-8 b(e)n(xt)18 b Fg(operation)d(which)i(stores)h(the)f
(selection)g(which)g(w)o(as)h(mod-)2025 4900 y(i\002ed:)23
b(in)16 b(this)h(case)f(chars)g Ff([7:12])p Fg(,)i(the)e(inserted)f(te)
o(xt)h(\223rules\224)f(and)2025 5000 y(the)22 b(replaced)e(te)o(xt)h
(\223rocks\224.)28 b(The)21 b Ff(Inser)s(tT)-8 b(e)n(xt)23
b Fg(object)e(needs)h(the)2025 5099 y(replaced)15 b(te)o(xt)h(so)g(it)h
(can)f(create)g(the)g(proper)e(in)m(v)o(erse)h(operation,)2025
5199 y(which)j(in)i(this)f(case)h(w)o(ould)e(be)h Ff(Inser)s(tT)-8
b(e)n(xt\([7:12],)20 b(\224roc)o(ks\224\))p Fg(.)26 b(Ne)o(xt)2025
5298 y(I)d(type)e(\223really)h(\224)h(in)f(front)g(of)g(\223rules\224.)
31 b(This)22 b(will)h(be)f Fi(op2)p Fg(,)g(an-)2025 5398
y(other)i Ff(Inser)s(tT)-8 b(e)n(xt)26 b Fg(operation)d(with)i
(selection)f(of)h Ff([7:7])p Fg(,)i(inserted)2025 5498
y(te)o(xt)h(of)g(\223really)g(\224,)i(and)e(replaced)f(te)o(xt)h
(\223\224.)50 b(No)n(w)28 b(what')-5 b(s)29 b(re-)2025
5597 y(quired)19 b(to)h(undo)f Fi(op1)p Fg(?)2108 5697
y(Just)33 b(applying)d(the)i(in)m(v)o(erse)f(of)g Fi(op1)h
Fg(to)g(the)g(current)e(doc-)2025 5797 y(ument)21 b(of)i(\223Python)e
(really)h(rules!\224)f(w)o(ould)h(result)g(in)h(\223Python)p
eop
%%Page: 2 2
2 1 bop 0 482 a Fg(rocksy)15 b(rules!\224)h(because)g(\223rules\224)g
(mo)o(v)o(ed)e(without)i Fi(op1)f Fg(kno)n(w-)0 581 y(ing)42
b(about)f(it.)92 b(The)42 b(approach)f(in)h(Prakash)g(and)g(Knister)0
681 y([PK94)o(])27 b(is)i(to)e(ha)n(v)o(e)g(a)h Ff(T)-8
b(r)o(anspose\(a,b\))28 b Fg(function)e(which)h(mod-)0
780 y(i\002es)h Ff(a)g Fg(to)g(mak)o(e)f(it)h(as)g(if)g
Ff(a)g Fg(w)o(as)g(applied)f(after)g Ff(b)p Fg(,)j(instead)d(of)0
880 y(before)21 b Ff(b)p Fg(.)33 b(In)23 b(the)f(case)i(of)e
Fi(op1)g Fg(and)g Fi(op2)p Fg(,)g(transposing)f(w)o(ould)0
980 y(in)m(v)n(olv)o(e)i(recognizing)f(that)j(op2)f(shifted)g(an)o(y)g
(character)f(posi-)0 1079 y(tions)j(>=)g(7)g(by)g(7)g(characters.)41
b(That)26 b(w)o(ould)f(mean)h(the)g(range)0 1179 y Ff([7:12])d
Fg(of)d Fi(op1)g Fg(w)o(ould)g(change)f(to)i Ff([14:19])p
Fg(.)29 b(No)n(w)20 b(the)h(in)m(v)o(erse)f(of)0 1279
y Fi(op1)f Fg(w)o(ould)h(correctly)f(create)h(\223Python)e(really)i
(rocks!\224.)83 1378 y(In)34 b(practice)g(the)g(algorithm)f(doesn')o(t)
g(actually)g(apply)h(the)0 1478 y Ff(T)-8 b(r)o(anspose\(\))31
b Fg(function)e(to)h(the)h(history)e(list)j(directly)-5
b(.)54 b(Instead)0 1577 y(it)24 b(copies)f(the)g(list)h(and)f
(transposes)g(the)g(operation)e(to)j(undo)d(to)0 1677
y(the)26 b(end.)40 b(Since)26 b(the)f(history)g(list)i(includes)e(e)n
(v)o(erything)e(done)0 1777 y(to)j(a)g(document,)f(the)g(end)g(of)h
(the)f(history)g(list)i(represents)e(the)0 1876 y(current)d(state)i(of)
g(the)f(document.)33 b(Then)23 b(the)g(algorithm)f(tak)o(es)0
1976 y(the)27 b(in)m(v)o(erse)f(of)g(the)h(transposed)f(operation)f
(and)h(applies)g(that)0 2076 y(to)20 b(the)h(document.)83
2175 y(There)29 b(are)g(cases)i(where)e(a)h(pre)n(vious)e(operation)g
(can')o(t)h(be)0 2275 y(undone.)60 b(What)32 b(if)h(after)f
Fi(op2)p Fg(,)j(instead)d(of)g(undoing)e Fi(op1)p Fg(,)k(I)0
2374 y(delete)23 b(the)h(entire)e(sentence)h(as)h Fi(op3)p
Fg(?)34 b(After)23 b(that)g(it)i(w)o(ouldn')o(t)0 2474
y(mak)o(e)43 b(much)g(sense)h(to)f(re)n(v)o(ert)g(\223rules\224)g(to)h
(\223rocks\224)e(since)0 2574 y(\223rules\224)22 b(no)f(longer)f(e)o
(xists!)31 b(T)-7 b(o)22 b(detect)f(such)h(con\003icts,)g(a)g
Ff(Con-)0 2673 y(\003ict\(a,b\))35 b Fg(function)d(is)j(de\002ned.)64
b(The)34 b(reason)e(the)i(algorithm)0 2773 y(needs)19
b(the)h Ff(Con\003ict\(a,b\))h Fg(function)d(is)i(because)f(not)g(all)i
(con\003icts)0 2873 y(will)27 b(pre)n(v)o(ent)d(an)i(undo.)42
b(Consider)25 b(applying)g Fi(op4)g Fg(as)i(the)f(in-)0
2972 y(v)o(erse)h(of)h Fi(op3)p Fg(.)48 b(There)27 b(is)i(still)g(a)f
(con\003ict)g(between)f Fi(op1)g Fg(and)0 3072 y Fi(op3)p
Fg(,)i(b)n(ut)g Fi(op4)e Fg(cancels)h(out)g Fi(op3)p
Fg(,)i(so)e(it)h(still)h(should)d(be)i(able)0 3171 y(to)21
b(undo)f Fi(op1)p Fg(.)28 b(A)22 b(method)e(called)h
Ff(remo)o(v)n(eDoUndoP)m(air)h Fg(handles)0 3271 y(these)e(situations.)
83 3371 y(In)30 b(summary)f(the)h(algorithm)e(to)j(undo)d(an)o(y)i(pre)
n(vious)e(op-)0 3470 y(eration)d(\002rst)i(copies)e(the)h(history)g
(list)h(from)e(the)h(point)f(of)h(the)0 3570 y(operation)h(to)h(be)h
(undone.)48 b(Then)27 b(it)i(transposes)f(that)h(opera-)0
3670 y(tion)21 b(to)g(the)f(end)h(of)f(the)h(list)h(cop)o(y)-5
b(.)26 b(This)21 b(brings)f(the)g(operation)0 3769 y(into)j(the)g
(current)f(state)j(of)e(the)g(document.)32 b(Then)23
b(it)h(tak)o(es)g(the)0 3869 y(in)m(v)o(erse)e(of)g(that)h(transposed)e
(operation)g(and)i(applies)f(it)i(to)f(the)0 3968 y(document)18
b(to)j(undo)d(the)j(original)e(operation.)0 4278 y Fh(2)99
b(The)26 b(History)e(Module)83 4472 y Fg(The)k Ff(Histor)r(y)h
Fg(module)e(de\002nes)g(three)h(objects:)41 b Ff(Histor)r(y)p
Fg(,)31 b(the)0 4571 y(actual)15 b(history)g(list,)j
Ff(Histor)r(yNode)p Fg(,)f(a)f(single)f(element)g(in)h(the)f(his-)0
4671 y(tory)25 b(list,)i(and)e Ff(Abstr)o(actOper)o(ation)p
Fg(,)k(which)c(you,)h(the)f(program-)0 4771 y(mer)m(,)19
b(subclass)i(to)f(create)g(your)f(o)n(wn)h(document)e(operations.)83
4870 y(Literate)30 b(programs)e(de\002ne)h(code)g(in)h(terms)g(of)f
(\223chunks\224.)0 4970 y(The)e(notation)g(belo)n(w)g(says)h(that)f
(the)h(\223History)-5 b(.p)o(y\224)26 b(chunk)g(is)0
5069 y(de\002ned)e(as)i(the)g(four)e(follo)n(wing)f(chunks.)39
b(Chunks)25 b(can)g(ha)n(v)o(e)0 5169 y(pieces)g(of)f(code)g(in)h(them)
f(as)h(well.)39 b(Chunks)24 b(can)g(also)h(be)g(ap-)0
5269 y(pended)j(to,)j(as)f(with)g(the)f Ff(Histor)r(yExceptions)j
Fg(chunk,)e(which)e(I)0 5368 y(add)20 b(on)f(to)i(whene)n(v)o(er)d(I)i
(need)g(to)g(de\002ne)g(a)g(ne)n(w)g(e)o(xception.)0
5483 y Fe(h)p Fd(History)l(.py)p Fe(i)s Fc(\021)83 5562
y Fe(h)p Fd(HistoryExceptions)p Fe(i)83 5641 y(h)p Fd(HistoryNode)p
Fe(i)83 5720 y(h)p Fd(Abstr)o(actOper)o(ation)p Fe(i)83
5799 y(h)p Fd(History)p Fe(i)2025 482 y Fj(2.1)92 b(Abstract)24
b(Operation)2108 672 y Fg(No)n(w)29 b(the)g(fun)g(part,)i
Ff(Abstr)o(actOper)o(ation)p Fg(.)55 b(It')-5 b(s)30
b(the)f(base)g(for)2025 772 y(operations)k(which)h(w)o(ork)f(on)h(a)h
(document.)66 b(These)34 b(opera-)2025 872 y(tions)27
b(must)h(de\002ne)f Ff(Con\003ict)p Fg(,)j Ff(T)-8 b(r)o(anspose)p
Fg(,)29 b Ff(in)o(v)n(erse)p Fg(,)h(and)d Ff(perf)n(or)r(m)2025
971 y Fg(methods.)32 b Ff(Abstr)o(actOper)o(ation)25
b Fg(de\002nes)e Ff(Con\003ict\(A,B\))i Fg(and)e Ff(T)-8
b(r)o(ans-)2025 1071 y(pose\(A,B\))25 b Fg(in)f(a)f(v)o(ery)g
(simplistic)h(w)o(ay)-5 b(.)34 b(An)o(y)22 b(serious)h(subclass)2025
1170 y(will)35 b(certainly)f(o)o(v)o(erride)e(these)i(methods)f(to)i
(be)f(more)g(ef)n(\002-)2025 1270 y(cient.)45 b Ff(Con\003ict)28
b Fg(checks)f(to)g(see)h(what)f(attrib)n(utes)g(are)g(af)n(fected)2025
1370 y(by)e(each)f(operation)f(and)i(signals)g(a)h(con\003ict)e(if)h
(the)o(y)g(o)o(v)o(erlap.)2025 1469 y Ff(T)-8 b(r)o(anspose)25
b Fg(just)g(tests)g(for)f(a)h(con\003ict)f(and)g(if)g(there)g(is)i
(none)d(re-)2025 1569 y(turns)17 b(the)h(identical)g(objects)f(sw)o
(apped.)23 b(The)18 b Ff(in)o(v)n(erse\(\))h Fg(and)e
Ff(per-)2025 1669 y(f)n(or)r(m\(\))i Fg(methods)d(are)i(also)f
(de\002ned)g(and)g(must)g(be)g(implemented)2025 1768
y(by)j(subclasses)i(to)f(pro)o(vide)e(the)i(in)m(v)o(erse)e(operation)g
(and)i(to)g(ac-)2025 1868 y(tually)f(modify)e(the)j(document.)2108
1967 y(Initially)j(I)h(had)g(hoped)e(to)i(be)g(able)f(to)h(mix)g(v)n
(arious)e(primi-)2025 2067 y(ti)n(v)o(e)17 b(operations)f(together)h
(and)g(ha)n(v)o(e)g(them)g(re)o(gister)g(what)g(the)o(y)2025
2167 y(af)n(fect)23 b(in)g(a)h(table)f(which)g(could)f(be)h(used)g(to)h
(deduce)e(the)h Ff(Con-)2025 2266 y(\003ict)28 b Fg(and)e
Ff(T)-8 b(r)o(anspose)28 b Fg(functions.)44 b(But)27
b(to)g(implement)f(ef)n(\002cient)2025 2366 y Ff(Con\003ict)33
b Fg(and)e Ff(T)-8 b(r)o(anspose)32 b Fg(routines)f(the)o(y)g(really)g
(ha)n(v)o(e)g(to)h(ha)n(v)o(e)2025 2466 y(detailed)24
b(kno)n(wledge)f(about)h(ho)n(w)g(all)h(operations)e(are)i(imple-)2025
2565 y(mented.)e(These)18 b(functions)f(violate)h(the)h(encapsulation)d
(of)i(op-)2025 2665 y(erations)26 b(because)g(the)o(y)f(need)h(to)g
(kno)n(w)g(ho)n(w)g(the)g(operations)2025 2764 y(represent)j(themselv)o
(es)h(and)g(what)g(the)o(y)g(do)g(to)g(a)h(document.)2025
2864 y(Conceptually)-5 b(,)21 b(operations)g(are)i(methods)f(of)h(some)
f Ff(Document)2025 2964 y Fg(object,)27 b(e)n(v)o(en)e(though)g(I)h
(implement)f(them)h(here)g(as)h(indepen-)2025 3063 y(dent)32
b(objects.)63 b(T)-7 b(o)33 b(implement)f Ff(Con\003ict)i
Fg(and)e Ff(T)-8 b(r)o(anspose)33 b Fg(you)2025 3163
y(need)21 b(to)h(kno)n(w)f(e)n(v)o(erything)e(about)i(all)h
(operations.)28 b(Y)-9 b(ou)22 b(can')o(t)2025 3263 y(just)17
b(add)f(in)h(a)g(ne)n(w)f(operation)f(without)h(thinking)f(through)f
(ho)n(w)2025 3362 y(it)22 b(will)g(af)n(fect)f(all)g(the)h(other)e
(operations.)27 b(This)21 b(may)g(not)g(be)g(as)2025
3462 y(limiting)26 b(as)i(you)d(might)h(think.)44 b(Y)-9
b(ou)26 b(can)g(easily)h(implement)2025 3561 y(higher)n(-le)n(v)o(el)17
b(actions)j(out)f(of)g(the)h(e)o(xisting)f(operations)f(and)h(be)2025
3661 y(able)h(to)g(undo)f(them)h(since)g(the)o(y)f(only)h(af)n(fected)e
(the)j(document)2025 3761 y(through)d(undoable)g(operations!)2025
3873 y Fe(h)p Fd(HistoryExceptions)p Fe(i)5 b Fc(\021)2108
3951 y Ff(UnimplementedBySubclass)19 b(=)g(\224This)f(method)h(m)o(ust)
g(be\\)2108 4030 y(implemented)g(b)o(y)f(a)g(subclass\224)2025
4221 y Fe(h)p Fd(Abstr)o(actOper)o(ation)p Fe(i)t Fc(\021)2108
4300 y Ff(class)h(Abstr)o(actOper)o(ation:)2145 4458
y(def)g(perf)n(or)r(m\(self)n(,conte)n(xt=None\):)2182
4537 y(retur)r(n)2145 4694 y(def)g(readSet\(self\):)2182
4773 y(retur)r(n)f(\(\))2145 4931 y(def)h(wr)q(iteSet\(self\):)2182
5010 y(retur)r(n)f(\(\))2145 5168 y(def)h(in)o(v)n(erse\(self\):)2182
5246 y(r)o(aise)g(UnimplementedBySubclass)2145 5404 y(def)g(cop)n
(y\(self\):)2182 5483 y(r)o(aise)g(UnimplementedBySubclass)2145
5641 y(def)g(T)-8 b(r)o(anspose\(a,)19 b(b\):)2182 5720
y(retur)r(n)f(\(b)m(,)i(a\))p eop
%%Page: 3 3
3 2 bop 120 482 a Ff(def)19 b(Con\003ict\(a,)g(b\):)157
560 y(if)g(a)f(is)g(None)h(or)f(b)g(is)h(None:)194 639
y(retur)r(n)f(None)157 718 y(bw)g(=)g(b)m(.wr)q(iteSet\(\))157
797 y(br)g(=)h(b)m(.readSet\(\))157 955 y(#)f(b)h(con\003icts)g(with)g
(a)f(if)h(it)f(reads)h(or)f(wr)q(ites)157 1034 y(#)g(an)o(ything)h(a)f
(wr)q(ites)157 1112 y(f)n(or)h(w)f(in)g(a.wr)q(iteSet\(\):)194
1191 y(if)g(w)h(in)f(bw)g(or)h(w)f(in)g(br)r(:)231 1270
y(retur)r(n)g(1)157 1428 y(#b)g(con\003icts)i(with)e(a)h(if)f(it)h(wr)q
(ites)g(an)o(ything)f(a)h(reads)157 1507 y(f)n(or)g(w)f(in)g
(a.readSet\(\):)194 1586 y(if)g(w)h(in)f(bw:)231 1665
y(retur)r(n)g(1)157 1743 y(retur)r(n)g(None)120 1901
y(def)h(isNullOp\(self\):)157 1980 y(retur)r(n)f(1)0
2221 y Fj(2.2)92 b(History)83 2420 y Fg(Once)18 b(you)g(ha)n(v)o(e)g
(the)g(details)h(of)f(your)f(primiti)n(v)o(e)g(operations)0
2520 y(w)o(ork)o(ed)33 b(out,)j(you)d(can)h(b)n(uild)f(composite)f
(operations)h(from)0 2619 y(them)27 b(and)g(kno)n(w)f(that)i(the)o(y)e
(will)i(be)g(undoable.)44 b(I)28 b(had)f(orig-)0 2719
y(inally)g(structured)g(the)g Ff(Histor)r(y)i Fg(class)g(as)g(a)f(tree)
f(so)i(that)e(com-)0 2819 y(posite)21 b(operations)f(w)o(ould)g(ha)n(v)
o(e)h(the)g(primiti)n(v)o(e)f(operations)g(as)0 2918
y(children)j(nodes.)35 b(That)24 b(w)o(ay)g(it)g(w)o(ould)f(be)h(easy)g
(to)g(recognize)0 3018 y(and)j(undo)g(an)h(entire)f(composite)g
(operation)f(at)j(once)e(by)g(un-)0 3117 y(doing)k(all)i(of)f(its)h
(children.)60 b(Ha)n(ving)32 b(the)g Ff(Histor)r(y)i
Fg(as)f(a)g(tree,)0 3217 y(ho)n(we)n(v)o(er)m(,)26 b(turned)g(the)h
(implementation)e(into)i(a)g(mess.)47 b(I)27 b(had)0
3317 y(de\002ned)18 b Ff(beginGroup\(\))h Fg(and)g Ff(endGroup\(\))g
Fg(methods)f(and)g(left)i(it)f(to)0 3416 y(the)29 b(programmer)d(to)j
(use)h(them)e(properly)-5 b(.)49 b(Later)29 b(I)g(realized)0
3516 y(that)20 b(it)h(w)o(ould)e(be)h(impossible)f(to)h(ha)n(v)o(e)f(a)
i(coherent)d(tree)i(struc-)0 3616 y(ture)25 b(if)g(in)g(f)o(act)g
(multiple)f(people)g(edited)h(a)g(document)e(simul-)0
3715 y(taneously)j(and)g(grouping)e(operations)h(were)i(not)g(atomic)f
(be-)0 3815 y(tween)c(the)h Ff(beginGroup\(\))f Fg(and)g
Ff(endGroup\(\))p Fg(.)32 b(I)22 b(decided)g(I)g(didn')o(t)0
3914 y(need)17 b(that)h(headache)e(and)h(turned)f Ff(Histor)r(y)j
Fg(into)e(a)h(list)h(with)e(call-)0 4014 y(backs)g(that)g(could)f(let)h
(programmers)d(k)o(eep)j(their)g(o)n(wn)f(tree)h(and)0
4114 y(also)k(k)o(eep)f(an)o(y)g(other)f(tables)i(of)f
Ff(Histor)r(yNodes)i Fg(the)o(y)e(w)o(ant.)26 b(F)o(or)0
4213 y(instance)i(I)h(could)e(k)o(eep)h(a)h(table)f(of)g(\002le)h
(transfers)f(that)h(were)0 4313 y(for)24 b(a)g(particular)f(product,)h
(or)g(maybe)f(de\002ne)h(an)g(e)o(xperimen-)0 4413 y(tal)f(mode)e(when)
h(the)h(user)f(is)h(playing)e(around)g(and)h(may)f(w)o(ant)0
4512 y(to)f(return)e(to)i(a)g(pre)n(vious)e(state)i(by)f(rejecting)g
(the)h(entire)f(e)o(xper)n(-)0 4612 y(iment.)83 4711
y(The)e Ff(Histor)r(y)i Fg(object)e(k)o(eeps)h(a)g(list)g(of)g(the)g
(operations)e(applied)0 4811 y(to)g(a)h(document,)d(pro)o(vides)h(the)h
(actual)g Ff(undo)g Fg(routine,)f(a)i(method)0 4911 y(to)k(call)h
(whene)n(v)o(er)d(an)j(operation)d(has)j(been)e(applied)g(to)i(a)f
(doc-)0 5010 y(ument,)g(and)h(callbacks)f(for)h(noti\002cation)e(of)i
(do)g(and)f(undo)g(ac-)0 5110 y(tions.)k(The)20 b Ff(Histor)r(y)h
Fg(attrib)n(utes)f(follo)n(w)-5 b(.)133 5202 y Ff(conte)n(xt)411
b Fg(the)20 b(object)g(that)g(applies)g(an)755 5302 y(operation)e(to)j
(a)f(document)133 5401 y Ff(histor)r(yList)322 b Fg(the)20
b(list)h(of)f(HistoryNodes)133 5501 y Ff(histor)r(yNodeClass)100
b Fg(the)20 b(class)h(used)f(for)755 5601 y(elements)g(of)g(the)g(list)
133 5700 y Ff(callbac)o(ks)350 b Fg(functions)19 b(to)h(call)755
5800 y(whene)n(v)o(er)e(a)j(node)e(is)i(added)2108 482
y(Callback)j(functions)g(must)h(tak)o(e)f(a)i Ff(Histor)r(y)g
Fg(object)e(and)g Ff(His-)2025 581 y(tor)r(yNode)d Fg(object)f(as)h
(their)f(\002rst)h(tw)o(o)f(ar)o(guments.)2025 702 y
Fe(h)p Fd(History)p Fe(i)r Fc(\021)2108 780 y Ff(class)f(Histor)r(y:)
2145 859 y(def)g(__init__\()g(self)n(,)2403
938 y(conte)n(xt,)2403 1017 y(histor)r(yList)h(=)e(None)o(,)2403
1096 y(histor)r(yNodeClass)h(=)g(Histor)r(yNode)o(,)2403
1175 y(callbac)o(ks)g(=)f(None)g(\):)2182 1254 y(self)n(.conte)n(xt)i
(=)f(conte)n(xt)2182 1333 y(if)g(histor)r(yList)g(is)f(not)h(None:)2219
1411 y(self)n(.histor)r(yList)h(=)e(histor)r(yList)2182
1490 y(else:)2219 1569 y(self)n(.histor)r(yList)i(=)e([])2182
1648 y(self)n(.histor)r(yNodeClass)i(=)e(histor)r(yNodeClass)2182
1727 y(if)h(callbac)o(ks)f(is)g(not)h(None:)2219 1806
y(self)n(.callbac)o(ks)g(=)f(callbac)o(ks)2182 1885 y(else:)2219
1963 y(self)n(.callbac)o(ks)h(=)f([])2145 2121 y(def)h(addHistor)r
(yOp\(self)n(,)g(op\):)2182 2200 y(histor)r(yNode)g(=)f(self)n(.histor)
r(yNodeClass\(op\))2182 2279 y(self)n(.histor)r(yList.append\(histor)r
(yNode\))2182 2358 y(f)n(or)h(call)f(in)g(self)n(.callbac)o(ks:)2219
2437 y(call\(self)n(,)h(histor)r(yNode\))2145 2594 y(def)g(addCallbac)o
(k\(self)n(,)f(callbac)o(k\):)2182 2673 y(self)n(.callbac)o(ks)o
(.append\(callbac)o(k\))2145 2831 y(def)h(remo)o(v)n(eCallbac)o
(k\(self)n(,)g(callbac)o(k\):)2182 2910 y(self)n(.callbac)o(ks)o(.remo)
o(v)n(e\(callbac)o(k\))2145 3068 y Fe(h)p Fd(undo)f(r)m(outines)p
Fe(i)2025 3308 y Fj(2.3)92 b(HistoryNode)2108 3508 y
Fg(The)16 b Ff(Histor)r(yNode)i Fg(holds)e(some)g(special)h
(information)d(for)i(the)2025 3607 y(undo)28 b(algorithm,)h(the)g
(operation)e(that)i(w)o(as)h(performed,)e(and)2025 3707
y(an)o(y)h(other)h(attrib)n(utes)g(you)g(w)o(ant)g(to)g(add)g(in)h(via)
f(a)h(callback,)2025 3807 y(such)21 b(as)h(username)d(or)i(timestamp.)
28 b(It)21 b(can)g(also)g(mak)o(e)g(a)g(cop)o(y)2025
3906 y(of)c(the)g(undo)f(related)g(attrib)n(utes)i(for)e(use)h(in)h
(the)f(undo)f(routines.)2025 4006 y(The)k(undo)f(related)g(attrib)n
(utes)h(follo)n(w)-5 b(.)2158 4085 y Ff(op)578 b Fg(the)20
b(operation)e(performed)2158 4184 y Ff(undoBloc)o(kMember)100
b Fg(whether)19 b(this)i(is)g(part)f(of)2810 4284 y(a)g(nested)g
(do/undo)e(block)2158 4384 y Ff(undoneBy)353 b Fg(the)20
b Ff(Histor)r(yNode)h Fg(which)2810 4483 y(undid)e(this)h(operation)
2158 4583 y Ff(undid)489 b Fg(the)20 b Ff(Histor)r(yNode)h
Fg(which)2810 4683 y(this)g(operation)d(undid)2025 4812
y Fe(h)p Fd(HistoryNode)p Fe(i)s Fc(\021)2108 4891 y
Ff(class)h(Histor)r(yNode:)2145 5049 y(def)g(__init__)g(\()
37 b(self)n(,)2440 5128 y(op)n(,)2440 5206 y(undoBloc)o(kMember)19
b(=)f(None)o(,)2440 5285 y(undoneBy)h(=)f(None)o(,)2440
5364 y(undid)g(=)h(None\))f(:)2182 5522 y(self)n(.op)h(=)f(op)2182
5601 y(self)n(.undoBloc)o(kMember)h(=)g(undoBloc)o(kMember)2182
5680 y(self)n(.undoneBy)g(=)f(undoneBy)2182 5759 y(self)n(.undid)h(=)f
(undid)p eop
%%Page: 4 4
4 3 bop 120 560 a Ff(def)19 b(tempCop)n(y\(self\):)157
639 y(retur)r(n)f(self)n(.__class__\()39
b(self)n(.op)n(.cop)n(y\(\),)342 718 y(undoBloc)o(kMember)18
b(=)h(self)n(.undoBloc)o(kMember)m(,)342 797 y(undoneBy)f(=)g(self)n
(.undoneBy)-7 b(,)342 876 y(undid)17 b(=)i(self)n(.undid\))0
1117 y Fj(2.4)92 b(Undo)83 1316 y Fg(The)21 b(undo)g(algorithm)f(is)i
(actually)f(quite)h(simple.)29 b(It)22 b(mak)o(es)0 1416
y(a)33 b(cop)o(y)e(of)h(all)g(operations)f(starting)g(after)h(the)g
(one)g(to)g(undo)0 1515 y(and)16 b(ending)g(with)h(the)g(last)h
(operation)d(done)g(on)i(the)g(document.)0 1615 y(Then)26
b(it)i(mo)o(v)o(es)e(the)h(undo)f(operation)f(to)j(the)f(end)f(of)h
(the)g(list)0 1714 y(by)17 b(transposing)g(elements,)g(checking)g(for)g
(con\003icts)h(along)f(the)0 1814 y(w)o(ay)-5 b(.)33
b(Once)23 b(it)h(is)g(at)f(the)g(end)g(of)g(the)g(list,)i(it)e(tak)o
(es)h(the)f(in)m(v)o(erse)0 1914 y(and)e(applies)g(it)h(to)f(the)g
(document.)26 b(Actually)21 b(there)g(is)h(another)0
2013 y(detail:)33 b(if)24 b(an)f(operation)f(in)i(the)g(list)h(cop)o(y)
e(is)i(already)e(undone)0 2113 y(and)16 b(con\003icts)h(with)h(the)f
(operation)e(to)i(undo,)f(there)g(really)h(isn')o(t)0
2213 y(a)28 b(con\003ict)f(since)g(the)g(of)n(fending)e(operation)g(w)o
(as)j(undone)d(al-)0 2312 y(ready)-5 b(.)36 b(In)24 b(that)g(case)h(it)
g(can)f(remo)o(v)o(e)f(the)h(do-undo)e(pair)i(from)0
2412 y(the)c(cop)o(y)g(of)f(the)i(list.)0 2516 y Fe(h)p
Fd(HistoryExceptions)p Fe(i)5 b Fb(+)o Fc(\021)83 2594
y Ff(UndoCon\003ict)19 b(=)f(\224Undo)g(con\003ict,)i(incompatib)o(le)e
(oper)o(ations\224)0 2794 y Fe(h)p Fd(undo)g(r)m(outines)p
Fe(i)r Fc(\021)83 2873 y Fe(h)p Fd(undo)p Fe(i)83 2951
y(h)p Fd(r)n(emo)o(veDoUndoP)-5 b(air)r Fe(i)83 3030
y(h)p Fd(tempListF)e(orUndo)p Fe(i)0 3293 y Fa(2.4.1)81
b(tempListF)n(orUndo)0 3449 y Fg(The)63 b Ff(tempListF)n(orUndo)i
Fg(method)e(constructs)g(a)h(cop)o(y)f(of)0 3548 y Ff(self)n(.histor)r
(yList)54 b Fg(starting)d(just)h(after)f(the)h(node)e(to)i(be)f(un-)0
3648 y(done,)24 b(cop)o(ying)e(each)i Ff(Histor)r(yNode)h
Fg(by)f(calling)g(its)h Ff(tempCop)n(y\(\))0 3747 y Fg(method.)54
b(I)30 b(k)o(eep)g(a)h(\003ag)f(in)g Ff(Histor)r(yNode)i
Fg(for)d(nested)h(blocks)0 3847 y(of)c(do-undo')-5 b(s.)42
b(ABCDD'C'B'A)-9 b(')27 b(is)h(ef)n(fecti)n(v)o(ely)d(a)i(null)f(op-)0
3947 y(eration,)31 b(where)e(the)h(primes)f(signify)g(undo)f
(operations.)52 b(As)0 4046 y(such)30 b(it)g(can)g(be)g(ignored)e
(completely)-5 b(,)31 b(so)f(I)g(skip)g(o)o(v)o(er)f(such)0
4146 y(blocks)d(when)h(making)f(the)h(temporary)e(list.)46
b(I)28 b(also)f(return)f(a)0 4246 y(dictionary)g(with)j(ne)n(w)f
Ff(Histor)r(yNode)h Fg(copies)f(as)g(k)o(e)o(ys)g(and)g(old)0
4345 y Ff(Histor)r(yNodes)c Fg(as)g(v)n(alues)e(so)h(an)o(y)f(e)o
(xceptions)g(can)g(refer)h(to)g(the)0 4445 y(original)g(nodes)h(to)g
(get)g(all)h(the)g(attrib)n(utes)f(stored)g(in)g(it)h(which)0
4544 y(may)20 b(not)g(be)g(in)g(the)g(cop)o(y)-5 b(.)0
4648 y Fe(h)p Fd(HistoryExceptions)p Fe(i)5 b Fb(+)o
Fc(\021)83 4727 y Ff(NoHistNode)18 b(=)h(\224histor)r(yNode)g(not)f(f)n
(ound)h(in)f(histor)r(yList\224)0 4847 y Fe(h)p Fd(tempListF)-7
b(orUndo)p Fe(i)s Fc(\021)83 4926 y Ff(def)19 b(tempListF)n
(orUndo\(self)n(,)h(histor)r(yNode\):)120 5005 y(if)f(histor)r(yNode)f
(not)h(in)f(self)n(.histor)r(yList:)157 5084 y(r)o(aise)h(NoHistNode)o
(,)g(\(histor)r(yNode)o(,)g(self\))120 5242 y(histList)g(=)f(self)n
(.histor)r(yList[)360 5321 y(self)n(.histor)r(yList.inde)n(x\(histor)r
(yNode\)+1:])120 5400 y(cop)n(y)h(=)f([])120 5557 y(ne)o(wT)-8
b(oOldMap)17 b(=)h({})120 5636 y(oldT)-8 b(oNe)o(wMap)17
b(=)h({})120 5794 y(skipUntil)g(=)h(None)2145 482
y(f)n(or)g(node)f(in)g(histList:)2182 560 y(if)h(\(not)f(skipUntil)h
(and)f(node)o(.undoBloc)o(kMember)2256 639 y(and)g(node)o(.undoneBy\):)
2219 718 y(skipUntil)g(=)g(node)o(.undoneBy)2182 797
y(if)h(skipUntil)f(and)g(node)g(!=)h(skipUntil:)2219
876 y(contin)o(ue)2182 955 y(elif)f(node)g(is)h(skipUntil:)2219
1034 y(skipUntil)f(=)g(None)2219 1112 y(contin)o(ue)37
b(#)19 b(w)o(e)f(still)h(w)o(ant)f(to)h(skip)g(this)g(node)2182
1191 y(ne)o(wnode)f(=)g(node)o(.tempCop)n(y\(\))2182
1270 y(cop)n(y)-7 b(.append\(ne)o(wnode\))2182 1349 y(ne)o(wT)f
(oOldMap[ne)o(wnode])17 b(=)h(node)2182 1428 y(oldT)-8
b(oNe)o(wMap[node])18 b(=)g(ne)o(wnode)2145 1507 y(f)n(or)h(node)f(in)g
(cop)n(y:)2182 1586 y(if)h(node)o(.undoneBy:)2219 1665
y(node)o(.undoneBy)g(=)f(oldT)-8 b(oNe)o(wMap[node)o(.undoneBy])2182
1743 y(if)19 b(node)o(.undid)f(and)g(oldT)-8 b(oNe)o(wMap)n(.has_k)o
(e)o(y\(node)o(.undid\):)2219 1822 y(node)o(.undid)18
b(=)g(oldT)-8 b(oNe)o(wMap[node)o(.undid])2145 1901 y(retur)r(n)19
b(cop)n(y)-7 b(,)19 b(ne)o(wT)-8 b(oOldMap)2025 2163
y Fa(2.4.2)81 b(r)o(emo)o(v)o(eDoUndoP)o(air)2025 2318
y Fg(The)24 b Ff(remo)o(v)n(eDoUndoP)m(air)h Fg(method)e(modi\002es)g
(nodes)g(in)h(the)g(list)2025 2418 y(passed)19 b(in)g(to)g(cancel)g
(out)g(a)g Fi(do-undo)e Fg(pair)h(by)h(transposing)f(the)2025
2518 y Fi(do)27 b Fg(until)h(it)g(is)h(ne)o(xt)e(to)h(the)g
Fi(undo)p Fg(.)46 b(Whe)o(y)27 b(the)o(y)g(are)h(together)2025
2617 y(the)o(y)g(nullify)-5 b(,)28 b(which)g(it)h(signals)g(by)f
(setting)g(the)g Ff(op)h Fg(attrib)n(ute)2025 2717 y(to)c
Ff(None)h Fg(for)f(both)f(of)h(them.)40 b(It)26 b(does)f(kno)n(w)f(for)
h(sure)g(though)2025 2816 y(that)d(there)g(are)g(no)f(real)i
(con\003icts)f(between)f(the)h Fi(do)g Fg(and)f Fi(undo)p
Fg(,)2025 2916 y(otherwise)g(the)i Fi(do)e Fg(could)h(not)f(ha)n(v)o(e)
h(been)f(undone)f(in)j(the)f(\002rst)2025 3016 y(place!)59
b(So)32 b(if)h(an)o(y)e(con\003icts)g(are)h(found)e(it)j(kno)n(ws)e
(that)h(the)2025 3115 y(of)n(fending)27 b(operation)h(has)i(already)f
(been)g(undone)f(and)h(calls)2025 3215 y Ff(remo)o(v)n(eDoUndoP)m
(air\(\))22 b Fg(recursi)n(v)o(ely)c(to)i(eliminate)g(it.)2025
3318 y Fe(h)p Fd(r)n(emo)o(veDoUndoP)-5 b(air)r Fe(i)r
Fc(\021)2108 3397 y Ff(def)19 b(remo)o(v)n(eDoUndoP)m(air\(self)n(,)h
(tempList\):)2145 3476 y(doNode)e(=)g(tempList[0])2145
3555 y(f)n(or)h(inde)n(x)f(in)g(r)o(ange\(1,)h(len\(tempList\)\):)2182
3634 y(node)f(=)g(tempList[inde)n(x])2182 3713 y(if)h(node)f(is)g
(doNode)o(.undoneBy:)2219 3792 y(break)2182 3870 y(if)h(node)o(.op)f
(is)g(None:)2219 3949 y(contin)o(ue)2182 4028 y(if)h(doNode)o(.op)n
(.Con\003ict\(node)o(.op\):)2219 4107 y(self)n(.remo)o(v)n(eDoUndoP)m
(air\(tempList[inde)n(x:]\))2182 4186 y(else:)2219 4265
y(node)o(.op)n(,)f(doNode)o(.op)h(=)f(doNode)o(.op)n(.T)-8
b(r)o(anspose\(node)o(.op\))2145 4344 y(doNode)o(.op)18
b(=)h(node)o(.op)f(=)g(None)2025 4589 y Fa(2.4.3)81 b(undo)2025
4745 y Fg(W)m(ith)28 b(all)g(the)g(support)e(for)i(the)f(undo)g
(algorithm)f(in)i(place,)h(it)2025 4844 y(practially)c(writes)h
(itself!)43 b(It)26 b(gets)g(a)g(cop)o(y)f(of)h(the)f(history)g(list)
2025 4944 y(to)h(w)o(ork)f(with,)i(shifts)g(the)e(operation)f(to)i
(undo)f(to)h(the)g(end)f(of)2025 5043 y(the)20 b(list,)i(then)d
(performs)g(its)i(in)m(v)o(erse)e(and)h(k)o(eeps)g(track)g(of)g(who)
2025 5143 y(undid)f(who.)2025 5246 y Fe(h)p Fd(undo)p
Fe(i)r Fc(\021)2108 5325 y Ff(def)g(undo\(self)n(,)g(histor)r(yNode\):)
2145 5483 y(tempList,)h(ne)o(wT)-8 b(oOldMap)17 b(=)h(self)n
(.tempListF)n(orUndo\()2754 5562 y(histor)r(yNode\))2145
5641 y(shiftOp)h(=)f(histor)r(yNode)o(.op)n(.cop)n(y\(\))2145
5799 y(inde)n(x)g(=)g(0)p eop
%%Page: 5 5
5 4 bop 120 560 a Ff(#mo)o(v)n(e)19 b(shiftOp)g(to)g(end)f(of)h(histor)
r(y)g(list)120 639 y(f)n(or)g(node)f(in)g(tempList:)157
718 y(if)h(node)o(.op)f(is)g(None)h(or)f(node)o(.op)n(.isNullOp\(\):)
194 797 y(contin)o(ue)157 876 y(if)h(shiftOp)n(.Con\003ict\(node)o
(.op\):)194 955 y(if)f(node)o(.undoneBy:)231 1034 y(self)n(.remo)o(v)n
(eDoUndoP)m(air\(tempList[inde)n(x:]\))194 1112 y(else:)231
1191 y(r)o(aise)g(UndoCon\003ict,\(histor)r(yNode)o(,ne)o(wT)-8
b(oOldMap[node]\))157 1270 y(else:)194 1349 y(un)o(used,)19
b(shiftOp)g(=)f(shiftOp)n(.T)-8 b(r)o(anspose\(node)o(.op\))157
1428 y(inde)n(x)18 b(=)g(inde)n(x)h(+)f(1)120 1586 y(#perf)n(or)r(m)h
(the)g(in)o(v)n(erse)o(,)120 1665 y(#conte)n(xt)g(will)f(call)g(us)h
(bac)o(k)f(to)h(add)f(it)h(to)g(Histor)r(y)120 1743 y(self)n(.conte)n
(xt.perf)n(or)r(mOp\(shiftOp)n(.in)o(v)n(erse\(\)\))120
1822 y(endNode)f(=)g(self)n(.histor)r(yList[-1])120 1901
y(histor)r(yNode)o(.undoneBy)h(=)g(endNode)120 1980 y(endNode)o(.undid)
f(=)g(histor)r(yNode)120 2059 y(if)h(not)f(tempList:)39
b(#means)18 b(all)g(ops)h(betw)o(een)g(histor)r(yNode)g(and)526
2138 y(#end)f(cancelled)g(out)157 2217 y(endNode)o(.undoBloc)o(kMember)
h(=)f(1)157 2296 y(histor)r(yNode)o(.undoBloc)o(kMember)h(=)g(1)0
2636 y Fh(Conclusion:)68 b(Guidelines)43 b(f)n(or)f(b)n(uilding)i
(docu-)0 2752 y(ment)26 b(objects)f(and)h(possible)f(uses)83
2951 y Fg(So)17 b(what)f(ha)n(v)o(e)f(I)i(learned)e(about)g
(structuring)g(document)f(ob-)0 3051 y(jects)k(for)f(undo?)23
b(One)17 b(thing)g(is)i(that)e(it)i(is)f(not)f(easy)h(to)g(structure)0
3151 y(the)g(undo)f(objects)h(into)h(a)f(separate)g(module.)23
b(The)o(y)17 b(need)h(to)h(be)0 3250 y(tied)i(directly)e(to)i(the)f
(implementation)f(of)h(the)h(operations)d(that)0 3350
y(modify)30 b(documents)g(because)g(the)i(document)d(data)j(and)f(the)0
3450 y(operations)17 b(that)i(w)o(ork)g(on)f(it)i(need)e(to)h(kno)n(w)f
(about)g(each)g(other)0 3549 y(to)i(be)g(able)h(to)f(de\002ne)g
Ff(Con\003ict)h Fg(and)e Ff(T)-8 b(r)o(anspose)21 b Fg(properly)-5
b(.)83 3649 y(So)39 b(no)n(w)g(the)g(guidelines.)80 b(First,)45
b(come)38 b(up)h(with)g(your)0 3748 y(state)f(or)g(document)d
(representation)h(and)h(what)g(operations)0 3848 y(you)28
b(w)o(ant)g(to)h(change)e(that)i(state)g(with.)50 b(K)n(eep)28
b(in)h(mind)e(that)0 3948 y(to)21 b(be)g(undoable)e(you)h(must)h(pro)o
(vide)e(an)i(in)m(v)o(erse)f(for)h(each)f(op-)0 4047
y(eration.)42 b(Usually)26 b(this)g(means)g(squirrelling)e(a)o(w)o(ay)i
(whate)n(v)o(er)0 4147 y(that)18 b(operation)e(destro)o(ys)h(so)h(the)g
(in)m(v)o(erse)f(can)g(recreate)g(it.)25 b(Y)-9 b(ou)0
4247 y(will)29 b(also)g(need)f(to)g(de\002ne)g Ff(Con\003ict)i
Fg(and)e Ff(T)-8 b(r)o(anspose)29 b Fg(functions)0 4346
y(that)j(w)o(ork)e(o)o(v)o(er)g(all)j(operations.)57
b(W)m(ith)32 b(these)f(features)g(de-)0 4446 y(signed)g(in)h(at)g(the)g
(start)g(you')o(ll)f(ha)n(v)o(e)g(e)n(v)o(erything)f(the)h(selec-)0
4545 y(ti)n(v)o(e)22 b(undo)f(algorithm)g(needs)h(to)h(w)o(ork.)31
b(Prakash)22 b(and)g(Knister)0 4645 y([PK94)o(])30 b(gi)n(v)o(es)g
(some)f(e)o(xcellent)h(e)o(xamples)f(of)g(implementa-)0
4745 y(tions)20 b(of)g(this)h(frame)n(w)o(ork.)83 4844
y(The)c(prototypical)e(modules)h(I')l(v)o(e)h(presented)f(do)g(w)o
(ork.)24 b(I')l(v)o(e)0 4944 y(tested)h(them)f(b)n(ut)h(ha)n(v)o(e)f
(not)g(used)h(them)f(e)o(xtensi)n(v)o(ely)-5 b(,)23 b(so)i(the)o(y)0
5044 y(are)34 b(not)f(mature)g(by)g(an)o(y)g(means.)66
b(In)33 b(a)h(real)g(application)e(I)0 5143 y(w)o(ould)25
b(impro)o(v)o(e)e(them)j(by)f(customizing)f(or)i(subclassing)f
Ff(Ab-)0 5243 y(str)o(actOper)o(ation)p Fg(.)h(The)16
b Ff(readSet)h Fg(and)f Ff(wr)q(iteSet)i Fg(approach)c(may)i(not)0
5342 y(be)28 b(the)h(correct)f(w)o(ay)g(to)h(determine)e(con\003icts)h
(for)g(the)h(docu-)0 5442 y(ment)g(representation.)51
b(At)31 b(the)e(v)o(ery)g(least)h(I)g(w)o(ould)f(change)0
5542 y(them)f(to)h(use)g(real)g Ff(Set)h Fg(objects.)50
b(The)28 b(conte)o(xt)f(and)h(callback)0 5641 y(mechanisms)e(for)g
(actually)g(performing)e(the)j(operations)e(and)0 5741
y(noti\002cation)d(of)g(additions)g(to)h(the)g(history)e(list)j(may)f
(need)f(im-)2025 482 y(pro)o(v)o(ements)37 b(for)i(performance)e
(reasons.)84 b(And,)44 b(with)c(the)2025 581 y Ff(Histor)r(y)30
b Fg(module)d(w)o(orking)g(to)h(satisf)o(action)h(no)n(w)-5
b(,)29 b(it)g(could)f(be)2025 681 y(mo)o(v)o(ed)18 b(into)i(C)h(or)f
(Ja)n(v)n(a)h(for)e(performance)f(reasons.)2108 780 y(Note)23
b(that)g(once)f(you)g(ha)n(v)o(e)g(all)h(your)f(operations)f(beha)n
(ving)2025 880 y(as)27 b(described)e(abo)o(v)o(e)f(you')l(v)o(e)g
(nearly)h(got)h(a)h(domain)d(speci\002c)2025 980 y(language!)46
b(Y)-9 b(ou)27 b(or)h(your)e(users)i(can)g(write)g(functions)e(using)
2025 1079 y(these)20 b(operations)e(and)h(get)h(undo)e(for)h(free.)25
b(W)m(ith)20 b(a)g(little)g(e)o(xtra)2025 1179 y(book)o(eeping)g(you)j
(could)f(record)f(which)i(function)e(in)m(v)n(ocation)2025
1279 y(caused)26 b(which)h(operations)e(in)i(the)g(history)f(list)i
(and)e(use)h(that)2025 1378 y(information)f(to)i(undo)f(the)i(entire)f
(thing)f(at)i(once.)49 b(Y)-9 b(our)27 b(op-)2025 1478
y(erations)21 b(and)g(document)f(object)h(represent)g(a)h(clean)f
(interf)o(ace)2025 1577 y(to)h(your)e(documents)f(and)i(should)f(allo)n
(w)i(for)f(clear)g(separation)2025 1677 y(between)30
b(your)g(UI)i(and)f(document)e(object.)57 b(In)31 b(addition)f(to)2025
1777 y(making)21 b(it)j(easy)f(to)g(embed)f(a)h(language)e(lik)o(e)i
(Python)f(in)h(your)2025 1876 y(application)29 b(for)i(macros,)i(it)e
(should)f(also)h(be)g(easy)g(for)g(pro-)2025 1976 y(grams,)22
b(e)n(v)o(en)g(remote)g(programs,)f(to)h(manipulate)f(documents)2025
2076 y(from)e(outside)h(the)g(application.)2108 2175
y(F)o(or)c(groupw)o(are)e(applications,)i(the)g(objects)g(w)o(ould)f
(be)i(writ-)2025 2275 y(ten)29 b(the)h(same)g(w)o(ay)-5
b(,)31 b(b)n(ut)e(the)h Ff(conte)n(xt)h Fg(object)e(w)o(ould)g(ha)n(v)o
(e)f(to)2025 2374 y(synchronize)d(with)j(a)h(central)e(serv)o(er)-5
b(.)47 b(The)28 b Ff(Con\003ict)g Fg(function)2025 2474
y(w)o(ould)16 b(help)h(identify)e(problems)h(when)g(users)h
(simultaneously)2025 2574 y(do)31 b(things)h(that)g(aren')o(t)e
(compatible.)59 b(Prakash)31 b(and)h(Knister)2025 2673
y([PK94)o(])20 b(goes)g(into)g(detail)g(about)f(these)i(issues.)2108
2773 y(\223Extending)j(programming)e(by)j(demosnstration)f(with)i(hi-)
2025 2873 y(erarchical)17 b(e)n(v)o(ent)h(histories\224)g(by)g(K)m
(osbie)h(and)f(Myers)g([KM94)n(])2025 2972 y(discusses)k(techniques)f
(for)g(analyzing)f(user')-5 b(s)22 b(histories)g(in)g(or)n(-)2025
3072 y(der)f(to)h(f)o(acilitate)g(\223programming)c(by)j
(demonstration\224.)27 b(The)o(y)2025 3171 y(recommend)c(k)o(eeping)h
(histories)h(as)i(a)e(tree)h(to)g(help)f(the)g(anal-)2025
3271 y(ysis.)62 b(This)33 b(could)e(be)h(done)f(f)o(airly)h(easily)h
(using)f(a)g Ff(callbac)o(k)2025 3371 y Fg(and)24 b(k)o(eeping)f(the)h
(tree)h(structure)e(e)o(xternal)h(to)g(the)h Ff(Histor)r(y)g
Fg(ob-)2025 3470 y(ject.)g(Y)-9 b(ou)17 b(could)h(then)f(use)i(their)f
(techniques)f(to)h(try)g(to)g(\223learn\224)2025 3570
y(what)h(the)h(user)f(is)i(doing.)i(Or)d(you)f(could)f(just)i(ha)n(v)o
(e)f(that)h(infor)n(-)2025 3670 y(mation)e(bro)n(wsable)g(to)h(help)f
(the)h(user)g(write)g(macros)f(based)h(on)2025 3769 y(what)h(the)o(y)g
(ha)n(v)o(e)f(been)h(doing.)2108 3869 y(Ev)o(er)e(since)i(I)g(started)f
(programming)d(graphical)i(user)h(inter)n(-)2025 3968
y(f)o(aces)d(I')l(v)o(e)e(been)h(curious)f(about)h(ho)n(w)g(to)h
(implement)e(undo)g(and)2025 4068 y(macro)22 b(languages.)33
b(Those)23 b(topics)g(ha)n(v)o(e)g(been)f(the)h(holy)g(grail)2025
4168 y(which)j(I')l(v)o(e)f(quested)g(after)-5 b(.)44
b(When)26 b(I)g(learned)f(about)h(Python)2025 4267 y(a)c(fe)n(w)f
(years)g(ago,)g(I)h(found)e(the)h(embeddable)e(language)h(I)i(w)o(as)
2025 4367 y(looking)28 b(for)-5 b(.)53 b(W)m(ith)29 b(Prakash)g(and)g
(Knister')-5 b(s)30 b(paper)f([PK94)n(])2025 4467 y(I')l(v)o(e)c
(\002nally)h(disco)o(v)o(ered)d(and)j(implemented)e(a)i(serious)g(undo)
2025 4566 y(frame)n(w)o(ork.)61 b(Their)32 b(approach)f(is)j(lik)o(e)f
(de\002ning)e(your)h(o)n(wn)2025 4666 y(algebra)25 b(for)h
(manipulating)e(documents)g(because)i(it)g(lets)h(you)2025
4765 y(switch)19 b(around)f(e)n(v)o(ents)g(in)h(the)g(history)g(so)g
(you)f(can)h(undo)f(an)o(y-)2025 4865 y(thing,)32 b(not)e(just)h(the)g
(last)g(action.)55 b(No)n(w)30 b(I'm)g(ready)g(to)g(do)g(a)2025
4965 y(really)20 b(killer)g(app!)k(An)o(y)c(ideas?)2025
5280 y Fh(A)-10 b(v)o(ailability)2108 5479 y Fg(The)37
b(source)f(code)g(for)g Ff(Histor)r(y)-7 b(.p)n(y)39
b Fg(and)d Ff(Undoab)o(leFileOper-)2025 5579 y(ations)o(.p)n(y)47
b Fg(will)g(be)e(a)n(v)n(ailable)h(by)f(the)h(time)g(this)g(paper)f(is)
2025 5679 y(published.)89 b(Check)42 b(either)g(on)g(the)g(Python)f
(home)g(page,)2025 5778 y(http://www)-5 b(.p)o(ython.or)o(g)30
b(or)35 b(look)f(for)h(my)g(quarters)f(on)h(the)p eop
%%Page: 6 6
6 5 bop 0 482 a Fg(Python)19 b(starship,)h(http://starship.sk)o
(yport.net/cre)n(w)-5 b(.h)o(tml.)0 797 y Fh(Refer)n(ences)0
996 y Fg([EG94])109 b(Erich)36 b(Gamma)h(et)g(al.)83
b Fi(Design)37 b(P)-7 b(atterns:)59 b(Ele-)323 1096 y(ments)33
b(of)f(Reusable)g(Object-Oriented)f(Softwar)m(e)p Fg(.)323
1196 y(Addison-W)-7 b(esle)o(y)i(,)18 b(94.)0 1362 y([KM94])49
b(Da)n(vid)24 b(S.)h(K)m(osbie)f(and)g(Brad)h(A.)g(Myers.)42
b(Extend-)323 1461 y(ing)c(programming)d(by)k(demonstration)d(with)j
(hi-)323 1561 y(erarchical)d(e)n(v)o(ent)g(histories.)85
b(T)-6 b(echnical)36 b(Report)323 1660 y(CMU-HCII-94-102,)27
b(Carne)o(gie)h(Mellon)g(Uni)n(v)o(er)n(-)323 1760 y(sity)-5
b(,)37 b(The)d(Human)f(Computer)g(Interaction)f(Insti-)323
1860 y(tute,)20 b(May)g(94.)0 2026 y([Knu92])39 b(D.E.)25
b(Knuth.)44 b Fi(Liter)o(ate)25 b(Pr)l(o)o(gr)o(amming)p
Fg(.)44 b(Stanford)323 2125 y(Uni)n(v)o(ersity)-5 b(,)18
b(92.)0 2291 y([PK94])77 b(Atul)22 b(Prakash)f(and)g(Michael)g(J.)h
(Knister)-5 b(.)34 b(Undoing)323 2391 y(actions)23 b(in)h(collaborati)n
(v)o(e)d(w)o(ork:)32 b(Frame)n(w)o(ork)22 b(and)323 2491
y(e)o(xperience.)d(T)-6 b(echnical)15 b(Report)h(CSE-TR-196-94,)323
2590 y(Uni)n(v)o(ersity)j(of)h(Michigan,)e(March)h(94.)0
2906 y Fh(A)n(ppendix:)32 b(Undoable)25 b(File)g(Operations)83
3105 y Fg(As)c(a)g(\002nal)f(e)o(xample)f(I')l(v)o(e)g(implemented)f
(some)i(simple)g(un-)0 3205 y(doable)g(\002le)h(operations.)k(The)o(y)
20 b(all)i(mo)o(v)o(e)d(\002les)j(that)f(w)o(ould)f(be)0
3304 y(deleted)d(into)h(a)h(trash)f(folder)f(and)g(remember)f(that)i
(the)o(y)g(did)f(so,)0 3404 y(so)h(the)o(y)g(can)f(be)h(undone)e(later)
j(if)f(need)f(be.)24 b(The)o(y)17 b(demonstrate)0 3504
y(ho)n(w)k(to)g(use)h(the)f Ff(readSet)i Fg(and)e Ff(wr)q(iteSet)i
Fg(routines)d(for)h(con\003icts.)0 3603 y(A)f(simple)f(test)h(routine)e
(creates)h(some)g(\002les,)h(deletes)f(them)g(all,)0
3703 y(then)h(undoes)f(the)h(\002rst)h(delete.)0 3807
y Fe(h)p Fd(UndoableF)m(ileOps.py)p Fe(i)t Fc(\021)83
3885 y Ff(impor)s(t)e(os)o(,)g(Histor)r(y)83 4043 y(class)g(Undoab)o
(leBinar)r(yFileOp\(Histor)r(y)-7 b(.Abstr)o(actOper)o(ation\):)120
4122 y(def)19 b(__init__\(self)n(,)g(fr)r(m,)h(to)m(,)g(tr)
o(ashDir)f(=)f(None)o(,)h(tr)o(ashed)g(=)f(None\):)157
4201 y(self)n(.fr)r(m)i(=)e(fr)r(m)157 4280 y(self)n(.to)i(=)e(to)157
4359 y(self)n(.op)h(=)f(None)157 4438 y(self)n(.tr)o(ashDir)i(=)e(tr)o
(ashDir)157 4516 y(self)n(.tr)o(ashed)i(=)e(tr)o(ashed)120
4595 y(def)h(perf)n(or)r(m\(self\):)157 4674 y(if)g(os)o
(.path.is\002le\(self)n(.to\))i(and)d(self)n(.tr)o(ashDir)i(is)e(not)h
(None:)194 4753 y(self)n(.tr)o(ashed)h(=)e(getUniqueName\(self)n(.to)m
(,)j(self)n(.tr)o(ashDir\))194 4832 y(os)o(.rename\(self)n(.to)m(,)g
(self)n(.tr)o(ashed\))157 4911 y(else:)194 4990 y(self)n(.tr)o(ashed)f
(=)e(None)157 5068 y(apply\(self)n(.op)n(,)h(\(self)n(.fr)r(m,)h(self)n
(.to\)\))120 5226 y(def)f(readSet\(self\):)157 5305 y(retur)r(n)f
(\(self)n(.fr)r(m,)j(\))120 5384 y(def)e(wr)q(iteSet\(self\):)157
5463 y(if)g(self)n(.tr)o(ashed:)194 5542 y(ret)g(=)f(\(self)n(.fr)r(m,)
i(self)n(.to)m(,)h(self)n(.tr)o(ashed\))157 5621 y(else:)194
5699 y(ret)e(=)f(\(self)n(.fr)r(m,)i(self)n(.to\))157
5778 y(retur)r(n)e(ret)2145 482 y(def)h(in)o(v)n(erse\(self\):)2182
560 y(retur)r(n)f(None)2145 639 y(def)h(isNullOp\(self\):)2182
718 y(retur)r(n)f(0)2108 876 y(class)h(Undoab)o(leMo)o(v)n(e\(Undoab)o
(leBinar)r(yFileOp\):)2145 955 y(def)g(__init__\(self)n(,)g
(fr)r(m,)h(to)m(,)g(tr)o(ashDir)f(=)f(None)o(,)h(tr)o(ashed)g(=)f
(None\):)2182 1034 y(Undoab)o(leBinar)r(yFileOp)n
(.__init__\(self)n(,)g(fr)r(m,)h(to)m(,)2736
1112 y(tr)o(ashDir)m(,)g(tr)o(ashed\))2182 1191 y(self)n(.op)g(=)f(os)o
(.rename)2145 1270 y(def)h(in)o(v)n(erse\(self\):)2182
1349 y(if)g(self)n(.tr)o(ashed:)2219 1428 y(ret)g(=)f(AtomicOpsT)-8
b(uple\(\(Undoab)o(leMo)o(v)n(e\(self)n(.to)m(,)20 b(self)n(.fr)r(m\),)
2330 1507 y(Undoab)o(leMo)o(v)n(e\(self)n(.tr)o(ashed,)g(self)n(.to)m
(,)g(self)n(.tr)o(ashDir\)\)\))2182 1586 y(else:)2219
1665 y(ret)f(=)f(Undoab)o(leMo)o(v)n(e\(self)n(.to)m(,)i(self)n(.fr)r
(m\))2182 1743 y(retur)r(n)e(ret)2145 1822 y(def)h(readSet\(self\):)
2182 1901 y(retur)r(n)f(\(self)n(.fr)r(m,)j(self)n(.to\))2145
1980 y(def)e(cop)n(y\(self\):)2182 2059 y(retur)r(n)f(Undoab)o(leMo)o
(v)n(e\(self)n(.fr)r(m,)j(self)n(.to)m(,)2551 2138 y(self)n(.tr)o
(ashDir)m(,)f(self)n(.tr)o(ashed\))2108 2296 y(class)f(Undoab)o(leCop)n
(y\(Undoab)o(leBinar)r(yFileOp\):)2145 2374 y(def)g
(__init__\(self)n(,)g(fr)r(m,)h(to)m(,)g(tr)o(ashDir)f(=)f
(None)o(,)h(tr)o(ashed)g(=)f(None\):)2182 2453 y(Undoab)o(leBinar)r
(yFileOp)n(.__init__\(self)n(,)g(fr)r(m,)h(to)m(,)2736
2532 y(tr)o(ashDir)m(,)g(tr)o(ashed\))2182 2611 y(self)n(.op)g(=)f(os)o
(.cop)n(y)2145 2690 y(def)h(in)o(v)n(erse\(self\):)2182
2769 y(if)g(\(self)n(.tr)o(ashed\):)2219 2848 y(retur)r(n)f(Undoab)o
(leMo)o(v)n(e\(self)n(.tr)o(ashed,)2588 2927 y(self)n(.to)m(,)j(self)n
(.tr)o(ashDir\))2182 3005 y(else:)2219 3084 y(retur)r(n)d(Undoab)o
(leDelete\(self)n(.to)m(,self)n(.tr)o(ashDir\))2145 3163
y(def)h(cop)n(y\(self\):)2182 3242 y(retur)r(n)f(Undoab)o(leCop)n
(y\(self)n(.fr)r(m,)i(self)n(.to)m(,)2551 3321 y(self)n(.tr)o(ashDir)m
(,)g(self)n(.tr)o(ashed\))2108 3479 y(class)f(Undoab)o
(leSymlink\(Undoab)o(leBinar)r(yFileOp\):)2145 3557 y(def)g
(__init__\(self)n(,)g(fr)r(m,)h(to)m(,)g(tr)o(ashDir)f(=)f
(None)o(,)h(tr)o(ashed)g(=)f(None\):)2182 3636 y(Undoab)o(leBinar)r
(yFileOp)n(.__init__\(self)n(,)g(fr)r(m,)h(to)m(,)2736
3715 y(tr)o(ashDir)m(,)g(tr)o(ashed\))2182 3794 y(self)n(.op)g(=)f(os)o
(.symlink)2145 3952 y(def)h(in)o(v)n(erse\(self\):)2182
4031 y(if)g(\(self)n(.tr)o(ashed\):)2219 4110 y(retur)r(n)f(Undoab)o
(leMo)o(v)n(e\(self)n(.tr)o(ashed,)2588 4188 y(self)n(.to)m(,)j(self)n
(.tr)o(ashDir\))2182 4267 y(else:)2219 4346 y(retur)r(n)d(Undoab)o
(leDelete\(self)n(.to)m(,self)n(.tr)o(ashDir\))2145 4504
y(def)h(cop)n(y\(self\):)2182 4583 y(retur)r(n)f(Undoab)o
(leSymlink\(self)n(.fr)r(m,)i(self)n(.to)m(,)2607 4662
y(self)n(.tr)o(ashDir)m(,)g(self)n(.tr)o(ashed\))2108
4819 y(class)f(Undoab)o(leHardlink\(Undoab)o(leBinar)r(yFileOp\):)2145
4898 y(def)g(__init__\(self)n(,)g(fr)r(m,)h(to)m(,)g(tr)o
(ashDir)f(=)f(None)o(,)h(tr)o(ashed)g(=)f(None\):)2182
4977 y(Undoab)o(leBinar)r(yFileOp)n(.__init__\(self)n(,)g
(fr)r(m,)h(to)m(,)2736 5056 y(tr)o(ashDir)m(,)g(tr)o(ashed\))2182
5135 y(self)n(.op)g(=)f(os)o(.link)2145 5293 y(def)h(in)o(v)n
(erse\(self\):)2182 5372 y(if)g(\(self)n(.tr)o(ashed\):)2219
5450 y(retur)r(n)f(Undoab)o(leMo)o(v)n(e\(self)n(.tr)o(ashed,)2588
5529 y(self)n(.to)m(,)j(self)n(.tr)o(ashDir\))2182 5608
y(else:)2219 5687 y(retur)r(n)d(Undoab)o(leDelete\(self)n(.to)m(,self)n
(.tr)o(ashDir\))p eop
%%Page: 7 7
7 6 bop 120 482 a Ff(def)19 b(cop)n(y\(self\):)157 560
y(retur)r(n)f(Undoab)o(leHardlink\(self)n(.fr)r(m,)h(self)n(.to)m(,)600
639 y(self)n(.tr)o(ashDir)m(,)h(self)n(.tr)o(ashed\))83
797 y(class)f(Undoab)o(leDelete\(Histor)r(y)-7 b(.Abstr)o(actOper)o
(ation\):)120 876 y(def)19 b(__init__\(self)n(,)g
(\002lename)o(,)g(tr)o(ashDir)h(=)e(None)o(,)h(tr)o(ashed)g(=)f
(None\):)157 955 y(self)n(.\002lename)h(=)f(\002lename)157
1034 y(self)n(.tr)o(ashDir)i(=)e(tr)o(ashDir)157 1112
y(self)n(.tr)o(ashed)i(=)e(tr)o(ashed)120 1270 y(def)h(cop)n
(y\(self\):)157 1349 y(retur)r(n)f(Undoab)o(leDelete\(self)n
(.\002lename)o(,)563 1428 y(self)n(.tr)o(ashDir)m(,)i(self)n(.tr)o
(ashed\))120 1586 y(def)f(perf)n(or)r(m\(self\):)157
1665 y(if)g(\(os)o(.path.is\002le\(self)n(.\002lename\))212
1743 y(and)g(self)n(.tr)o(ashDir)h(is)e(not)h(None\):)194
1822 y(self)n(.tr)o(ashed)h(=)e(getUniqueName\(self)n(.\002lename)o(,)
729 1901 y(self)n(.tr)o(ashDir\))157 1980 y(else:)194
2059 y(self)n(.tr)o(ashed)i(=)e(None)157 2138 y(if)h(self)n(.tr)o
(ashed:)194 2217 y(os)o(.rename\(self)n(.\002lename)o(,)h(self)n(.tr)o
(ashed\))157 2296 y(else:)194 2374 y(os)o(.unlink\(self)n
(.\002lename\))120 2532 y(def)f(readSet\(self\):)157
2611 y(retur)r(n)f(\(self)n(.\002lename)o(,\))120 2769
y(def)h(wr)q(iteSet\(self\):)157 2848 y(if)g(self)n(.tr)o(ashed:)194
2927 y(ret)g(=)f(\(self)n(.\002lename)o(,)i(self)n(.tr)o(ashed\))157
3005 y(else:)194 3084 y(ret)f(=)f(\(self)n(.\002lename\))157
3163 y(retur)r(n)g(ret)120 3321 y(def)h(in)o(v)n(erse\(self\):)157
3400 y(retur)r(n)f(Undoab)o(leMo)o(v)n(e\(self)n(.tr)o(ashed,)526
3479 y(self)n(.\002lename)o(,)i(self)n(.tr)o(ashDir\))120
3636 y(def)f(isNullOp\(self\):)157 3715 y(retur)r(n)f(0)83
3873 y(class)h(AtomicOpsT)-8 b(uple\(Histor)r(y)h(.Abstr)o(actOper)o
(ation\):)120 3952 y(def)19 b(__init__\(self)n(,)g(oper)o
(ationsT)-8 b(uple\):)157 4031 y(self)n(.oper)o(ationsT)g(uple)19
b(=)f(oper)o(ationsT)-8 b(uple)120 4188 y(def)19 b(cop)n(y\(self\):)157
4267 y(retur)r(n)f(AtomicOpsT)-8 b(uple\(self)n(.oper)o(ationsT)g
(uple\))120 4425 y(def)19 b(perf)n(or)r(m\(self\):)157
4504 y(f)n(or)g(op)f(in)g(self)n(.oper)o(ationsT)-8 b(uple:)194
4583 y(op)n(.perf)n(or)r(m\(\))120 4741 y(def)19 b(readSet\(self\):)157
4819 y(ret)g(=)f(\(\))157 4898 y(f)n(or)h(op)f(in)g(self)n(.oper)o
(ationsT)-8 b(uple:)194 4977 y(ret)19 b(=)f(ret)h(+)f(op)n
(.readSet\(\))157 5056 y(retur)r(n)g(ret)120 5214 y(def)h(wr)q
(iteSet\(self\):)157 5293 y(ret)g(=)f(\(\))157 5372 y(f)n(or)h(op)f(in)
g(self)n(.oper)o(ationsT)-8 b(uple:)194 5450 y(ret)19
b(=)f(ret)h(+)f(op)n(.wr)q(iteSet\(\))157 5529 y(retur)r(n)g(ret)120
5687 y(def)h(isNullOp\(self\):)157 5766 y(retur)r(n)f(0)2108
482 y(def)h(getUniqueName\(fn,)g(tr)o(ashDir\):)2145
560 y(base)f(=)h(os)o(.path.basename\(fn\))2145 639 y(count)g(=)f(1)
2145 718 y(result)h(=)f(os)o(.path.join\(tr)o(ashDir)m(,)i(base)f(+)f
('\045.3d')g(\045)h(count\))2145 797 y(while)f(os)o
(.path.is\002le\(result\):)2182 876 y(count)h(=)f(count)h(+)f(1)2182
955 y(result)h(=)f(os)o(.path.join\(tr)o(ashDir)m(,)i(base)f(+)f
('\045.3d')g(\045)h(count\))2145 1034 y(retur)r(n)g(result)2108
1191 y(if)g(__name__=='__main__':)2145
1270 y(limit)f(=)h(12)2145 1428 y(#a)f(helper)g(function)h(to)g(see)g
(what')m(s)f(going)g(on)2145 1507 y(def)h(listem\(\):)2182
1586 y(pr)q(int)2182 1665 y(f)n(or)g(dir)f(in)g([\224/tmp/tests\224,)23
b(\224/tmp/tests/tr)o(ash\224]:)2219 1743 y(l)18 b(=)g(os)o
(.listdir\(dir\))2219 1822 y(f)n(or)h(f)g(in)f(l:)2256
1901 y(fn)h(=)f(dir+'/')g(+)g(f)2256 1980 y(if)g(not)h(os)o
(.path.is\002le\(fn\):)2293 2059 y(pr)q(int)f('\223t')h(+)f(fn)2256
2138 y(else:)2293 2217 y(\002)g(=)h(open\(fn\))2293 2296
y(s)f(=)h(\002.read\(\))2293 2374 y(\002.close\(\))2293
2453 y(pr)q(int)f('\223t')h(+)f(fn,)h(s)2145 2611 y(#create)g(Conte)n
(xt)g(and)g(Histor)r(y)g(objects)2145 2690 y(class)g(Conte)n(xt:)2182
2769 y(def)g(perf)n(or)r(mOp\(self)n(,)g(op\):)2219 2848
y(op)n(.perf)n(or)r(m\(\))2219 2927 y(self)n(.histor)r(y)-7
b(.addHistor)r(yOp\(op\))2145 3005 y(c)19 b(=)f(Conte)n(xt\(\))2145
3084 y(h)g(=)h(Histor)r(y)-7 b(.Histor)r(y\(c\))2145
3163 y(c.histor)r(y)20 b(=)e(h)2145 3321 y(#create)h(some)g(director)q
(ies)g(and)f(\002les)g(to)h(pla)n(y)f(with)2145 3400
y(tr)r(y:)2182 3479 y(os)o(.mkdir\(\224/tmp/tests\224,0777\))2145
3557 y(e)n(xcept:)2182 3636 y(pass)2145 3794 y(tr)r(y:)2182
3873 y(os)o(.mkdir\(\224/tmp/tests/tr)o(ash\224,)24 b(0777\))2145
3952 y(e)n(xcept:)2182 4031 y(pass)2145 4188 y(f)n(or)19
b(x)g(in)f(r)o(ange\(limit\):)2182 4267 y(f)h(=)f(open\('/tmp/tests/he)
o(y'+str\(x\),)k('w'\))2182 4346 y(f)n(.wr)q(ite\(str\(x\)\))2182
4425 y(f)n(.close\(\))2145 4583 y(listem\(\))2145 4741
y(#delete)c(e)n(v)n(er)r(ything)2145 4819 y(f)n(or)h(x)g(in)f(r)o
(ange\(limit\):)2182 4898 y(u)g(=)h(Undoab)o(leDelete\('/tmp/tests/he)o
(y'+str\(x\),)2533 4977 y('/tmp/tests/tr)o(ash'\))2182
5056 y(c.perf)n(or)r(mOp\(u\))2145 5214 y(listem\(\))2145
5372 y(#undo)f(only)g(the)h(\002rst)h(delete)2145 5450
y(h.undo\(h.histor)r(yList[0]\))2145 5608 y(listem\(\))p
eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
